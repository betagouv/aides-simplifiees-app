# Code Conventions - Aides Simplifi√©es

## Backend (AdonisJS)

### Controllers

```typescript
// app/controllers/<domain>/<name>_controller.ts
import type { HttpContext } from '@adonisjs/core/http'

export default class ExampleController {
  // RESTful methods
  async index({ inertia }: HttpContext) {
    // Return an Inertia page
    return inertia.render('Domain/Page', { data })
  }

  async store({ request, response }: HttpContext) {
    // Create a resource
  }
}
```

### Services

```typescript
// app/services/<name>_service.ts
export default class ExampleService {
  // Isolated business logic
  async doSomething() {
    // ...
  }
}
```

### Models

```typescript
import type { HasMany } from '@adonisjs/lucid/types/relations'
import { BaseModel, column, hasMany } from '@adonisjs/lucid/orm'
// app/models/<name>.ts
import { DateTime } from 'luxon'

export default class Example extends BaseModel {
  @column({ isPrimary: true })
  declare id: number

  @column.dateTime({ autoCreate: true })
  declare createdAt: DateTime

  @hasMany(() => RelatedModel)
  declare related: HasMany<typeof RelatedModel>
}
```

## Frontend (Vue.js + Inertia)

### Inertia Pages

```vue
<!-- inertia/pages/<Domain>/<Name>.vue -->
<script setup lang="ts">
import { Head } from '@inertiajs/vue3'
import { computed } from 'vue'

// Typed props
interface Props {
  data: SomeType
}

const props = defineProps<Props>()
</script>

<template>
  <Head title="Page title" />
  <div>
    <!-- Content -->
  </div>
</template>
```

### Components

```vue
<!-- inertia/components/<Name>.vue -->
<script setup lang="ts">
// Use DSFR via VueDsfr
import { DsfrButton, DsfrInput } from '@gouvminint/vue-dsfr'

interface Props {
  modelValue: string
}

interface Emits {
  (e: 'update:modelValue', value: string): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
</script>

<template>
  <DsfrInput
    :model-value="modelValue"
    @update:model-value="emit('update:modelValue', $event)"
  />
</template>
```

## Specific Patterns

### Publicodes Form Handling

Forms are dynamically generated from Publicodes rules:

1. Rules defined in `publicodes/<name>/`
2. Build with `pnpm build:publicodes`
3. Render via `@publicodes/forms` in Vue components

### DSFR Integration

- Use VueDsfr components (`DsfrButton`, `DsfrInput`, etc.)
- Respect RGAA accessibility guidelines
- Test with `pnpm test:a11y`

### State Management

- Pinia stores in `inertia/stores/`
- Composables for reusable logic in `inertia/composables/`
- Inertia props for server data

### Middleware

Typical middleware order (see `start/kernel.ts`):
1. CORS
2. Session
3. Auth (or Guest or Silent Auth depending on route)
4. Admin (for admin routes)
